import { DynamicError } from '@dynamic-labs/utils';
import { decodeJwt } from '../../../shared/utils/functions/decodeJwt/decodeJwt.js';
import { createUserProfile } from '../createUserProfile/createUserProfile.js';
import { storeAuthToken } from '../storeAuthToken/index.js';

const updateJWTAndCreateUserProfile = (jwt) => {
    const decodedJWT = decodeJwt(jwt);
    if (!jwt || !decodedJWT) {
        throw new DynamicError('Invalid session');
    }
    storeAuthToken(jwt);
    return createUserProfile(decodedJWT);
};

export { updateJWTAndCreateUserProfile };
